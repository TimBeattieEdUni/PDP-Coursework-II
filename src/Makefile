##############################################################################
#  Parallel Design Patterns
#  Coursework Part II.
#
#  Makefile for directory "src".
#


##############################################################################
#  Running collection of things to clean up.
CLEANFILES =


##############################################################################
#  Build products.
APP     := squirrels

CLEANFILES += $(APP)


##############################################################################
#  Other things to be submitted (source code is handled later).
README  := readme
MORAR   := morar.sh


##############################################################################
#  Build system.
MF    := Makefile


##############################################################################
#  C++ compiler and flags.
CXX      := mpicxx
CXXFLAGS := -fastsse


##############################################################################
#  C source code and generated files.
SRC  := $(wildcard *.cpp)
HDR  := $(wildcard *.hpp)

OBJ  := $(SRC:.cpp=.o)
DEP  := $(SRC:.cpp=.d)

CLEANFILES += $(OBJ) $(DEP)


##############################################################################
#  Output from batch runs.
OUTPUT := $(wildcard *.sh.*)

CLEANFILES += $(OUTPUT)


##############################################################################
#  Primary target rules.
default: $(APP)

.PHONY: app clean

clean:
	rm -f $(CLEANFILES)


##############################################################################
#  Autogenerated header dependencies.
-include $(DEP)


##############################################################################
#  Libraries.
LIB = -lm


##############################################################################
#  Build object from C++ source.
%.o : %.cpp $(MF)
	$(CXX) -c $(CXXFLAGS) -o $@ $<


##############################################################################
#  Build executable from objects.
$(APP): $(OBJ) $(MF)
	$(CXX) -o $(APP) $(OBJ) $(LIB)
